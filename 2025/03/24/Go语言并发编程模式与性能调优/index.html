<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/Bopop-logo.png">
  <link rel="icon" type="image/png" href="/img/Bopop-logo.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="This v blog">
  <meta name="author" content="BoDen">
  <meta name="keywords" content="Bopop,blog,åšå®¢,PHP,Python,Golang">
  <title>âš¡ Goè¯­è¨€å¹¶å‘ç¼–ç¨‹æ¨¡å¼ä¸æ€§èƒ½è°ƒä¼˜ - Bopop</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 5.0.2"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Bopop</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/pexels.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
                âš¡ Goè¯­è¨€å¹¶å‘ç¼–ç¨‹æ¨¡å¼ä¸æ€§èƒ½è°ƒä¼˜
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2025-03-24 13:25">
      2025å¹´3æœˆ24æ—¥ ä¸‹åˆ
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.8k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      70
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1>âš¡ Goè¯­è¨€å¹¶å‘ç¼–ç¨‹æ¨¡å¼ä¸æ€§èƒ½è°ƒä¼˜</h1>
<p>Goè¯­è¨€å‡­å€Ÿå…¶ç®€æ´é«˜æ•ˆçš„å¹¶å‘æ¨¡å‹ï¼Œå·²æˆä¸ºæ„å»ºé«˜æ€§èƒ½æœåŠ¡çš„é¦–é€‰è¯­è¨€ä¹‹ä¸€ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Goçš„å¹¶å‘ç¼–ç¨‹æ¨¡å¼å’Œæ€§èƒ½è°ƒä¼˜æŠ€å·§ï¼Œç»“åˆæˆ‘åœ¨å®é™…é¡¹ç›®ä¸­çš„ç»éªŒï¼Œå¸®åŠ©ä½ ç¼–å†™æ›´é«˜æ•ˆçš„Goç¨‹åºã€‚</p>
<h2 id="ğŸ”„-Goå¹¶å‘æ¨¡å‹åŸºç¡€"><a class="header-anchor" href="#ğŸ”„-Goå¹¶å‘æ¨¡å‹åŸºç¡€"></a>ğŸ”„ Goå¹¶å‘æ¨¡å‹åŸºç¡€</h2>
<p>åœ¨æ·±å…¥å…·ä½“çš„å¹¶å‘æ¨¡å¼ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹Goå¹¶å‘çš„æ ¸å¿ƒæ¦‚å¿µï¼š</p>
<h3 id="goroutine-è½»é‡çº§çº¿ç¨‹"><a class="header-anchor" href="#goroutine-è½»é‡çº§çº¿ç¨‹"></a>goroutine: è½»é‡çº§çº¿ç¨‹</h3>
<p>goroutineæ˜¯Goè¯­è¨€çš„å¹¶å‘å•å…ƒï¼Œç”±Goè¿è¡Œæ—¶ç®¡ç†ï¼š</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
    <span class="hljs-comment">// å¯åŠ¨ä¸€ä¸ªgoroutine</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        fmt.Println(<span class="hljs-string">&quot;æˆ‘åœ¨ä¸€ä¸ªgoroutineä¸­è¿è¡Œ&quot;</span>)
    &#125;()
    
    <span class="hljs-comment">// ä¸»goroutineç»§ç»­æ‰§è¡Œ</span>
    fmt.Println(<span class="hljs-string">&quot;æˆ‘åœ¨ä¸»goroutineä¸­è¿è¡Œ&quot;</span>)
    time.Sleep(time.Second) <span class="hljs-comment">// ç¡®ä¿å­goroutineæœ‰æ—¶é—´æ‰§è¡Œ</span>
&#125;</code></pre>
<p>ä¸ä¼ ç»Ÿçº¿ç¨‹ç›¸æ¯”ï¼Œgoroutineæœ‰å‡ ä¸ªæ˜¾è‘—ä¼˜åŠ¿ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>ä¼ ç»Ÿçº¿ç¨‹</th>
<th>goroutine</th>
</tr>
</thead>
<tbody>
<tr>
<td>åˆ›å»ºæˆæœ¬</td>
<td>~1MBæ ˆç©ºé—´</td>
<td>åˆå§‹2KBæ ˆç©ºé—´</td>
</tr>
<tr>
<td>è°ƒåº¦æ–¹å¼</td>
<td>å†…æ ¸çº§è°ƒåº¦</td>
<td>ç”¨æˆ·çº§è°ƒåº¦(GMPæ¨¡å‹)</td>
</tr>
<tr>
<td>åˆ›å»ºæ•°é‡</td>
<td>å—ç³»ç»Ÿé™åˆ¶(æ•°åƒ)</td>
<td>å¯åˆ›å»ºæ•°ç™¾ä¸‡</td>
</tr>
<tr>
<td>ä¸Šä¸‹æ–‡åˆ‡æ¢</td>
<td>ç›¸å¯¹æ˜‚è´µ</td>
<td>éå¸¸è½»é‡</td>
</tr>
<tr>
<td>é€šä¿¡æ–¹å¼</td>
<td>å…±äº«å†…å­˜</td>
<td>CSPæ¨¡å‹(é€šè¿‡channel)</td>
</tr>
</tbody>
</table>
<h3 id="channel-é€šä¿¡æœºåˆ¶"><a class="header-anchor" href="#channel-é€šä¿¡æœºåˆ¶"></a>channel: é€šä¿¡æœºåˆ¶</h3>
<p>channelæ˜¯goroutineä¹‹é—´é€šä¿¡çš„ç®¡é“ï¼š</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ— ç¼“å†²channel</span>
    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">string</span>)
    
    <span class="hljs-comment">// å‘é€è€…goroutine</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        ch &lt;- <span class="hljs-string">&quot;Hello from goroutine!&quot;</span> <span class="hljs-comment">// å‘é€æ•°æ®</span>
    &#125;()
    
    <span class="hljs-comment">// æ¥æ”¶è€…(ä¸»goroutine)</span>
    msg := &lt;-ch <span class="hljs-comment">// æ¥æ”¶æ•°æ®</span>
    fmt.Println(msg)
&#125;</code></pre>
<p>channelæœ‰ä¸¤ç§ä¸»è¦ç±»å‹ï¼š</p>
<ol>
<li><strong>æ— ç¼“å†²channel</strong>ï¼šå‘é€æ“ä½œä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æ¥æ”¶è€…</li>
<li><strong>å¸¦ç¼“å†²channel</strong>ï¼šæœ‰å®¹é‡é™åˆ¶ï¼Œç¼“å†²åŒºæ»¡æ—¶å‘é€æ‰ä¼šé˜»å¡</li>
</ol>
<pre><code class="hljs go"><span class="hljs-comment">// å¸¦ç¼“å†²channel(å®¹é‡ä¸º3)</span>
bufferedCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">3</span>)
bufferedCh &lt;- <span class="hljs-number">1</span>  <span class="hljs-comment">// ä¸ä¼šé˜»å¡</span>
bufferedCh &lt;- <span class="hljs-number">2</span>  <span class="hljs-comment">// ä¸ä¼šé˜»å¡</span>
bufferedCh &lt;- <span class="hljs-number">3</span>  <span class="hljs-comment">// ä¸ä¼šé˜»å¡</span>
<span class="hljs-comment">// bufferedCh &lt;- 4  // ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰å€¼è¢«å–å‡º</span></code></pre>
<h2 id="ğŸ”¨-å¸¸ç”¨å¹¶å‘æ¨¡å¼"><a class="header-anchor" href="#ğŸ”¨-å¸¸ç”¨å¹¶å‘æ¨¡å¼"></a>ğŸ”¨ å¸¸ç”¨å¹¶å‘æ¨¡å¼</h2>
<h3 id="1-Worker-Pool-å·¥ä½œæ± æ¨¡å¼"><a class="header-anchor" href="#1-Worker-Pool-å·¥ä½œæ± æ¨¡å¼"></a>1. Worker Pool (å·¥ä½œæ± æ¨¡å¼)</h3>
<p>å·¥ä½œæ± æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­æœ€å¸¸ç”¨çš„æ¨¡å¼ä¹‹ä¸€ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡ç‹¬ç«‹ä»»åŠ¡ï¼š</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WorkerPool</span><span class="hljs-params">(numWorkers <span class="hljs-keyword">int</span>, tasks []Task, timeout time.Duration)</span> []<span class="hljs-title">Result</span></span> &#123;
    tasksCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Task, <span class="hljs-built_in">len</span>(tasks))
    resultsCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Result, <span class="hljs-built_in">len</span>(tasks))
    
    <span class="hljs-comment">// å¯åŠ¨å·¥ä½œgoroutine</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; numWorkers; i++ &#123;
        <span class="hljs-keyword">go</span> worker(tasksCh, resultsCh)
    &#125;
    
    <span class="hljs-comment">// å‘é€ä»»åŠ¡</span>
    <span class="hljs-keyword">for</span> _, task := <span class="hljs-keyword">range</span> tasks &#123;
        tasksCh &lt;- task
    &#125;
    <span class="hljs-built_in">close</span>(tasksCh) <span class="hljs-comment">// å…³é—­ä»»åŠ¡é€šé“ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šä»»åŠ¡</span>
    
    <span class="hljs-comment">// æ”¶é›†ç»“æœ</span>
    results := <span class="hljs-built_in">make</span>([]Result, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(tasks))
    timeoutCh := time.After(timeout)
    
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(tasks); i++ &#123;
        <span class="hljs-keyword">select</span> &#123;
        <span class="hljs-keyword">case</span> result := &lt;-resultsCh:
            results = <span class="hljs-built_in">append</span>(results, result)
        <span class="hljs-keyword">case</span> &lt;-timeoutCh:
            <span class="hljs-keyword">return</span> results <span class="hljs-comment">// è¶…æ—¶è¿”å›å·²æ”¶é›†çš„ç»“æœ</span>
        &#125;
    &#125;
    
    <span class="hljs-keyword">return</span> results
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker</span><span class="hljs-params">(tasksCh &lt;-<span class="hljs-keyword">chan</span> Task, resultsCh <span class="hljs-keyword">chan</span>&lt;- Result)</span></span> &#123;
    <span class="hljs-keyword">for</span> task := <span class="hljs-keyword">range</span> tasksCh &#123;
        result := process(task)
        resultsCh &lt;- result
    &#125;
&#125;</code></pre>
<p>å·¥ä½œæ± æ¨¡å¼çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ§åˆ¶å¹¶å‘åº¦ï¼Œé¿å…èµ„æºè€—å°½</li>
<li>é‡ç”¨goroutineï¼Œå‡å°‘åˆ›å»º/é”€æ¯å¼€é”€</li>
<li>ä¾¿äºæ·»åŠ è¶…æ—¶æ§åˆ¶å’Œé”™è¯¯å¤„ç†</li>
</ul>
<h3 id="2-Pipeline-ç®¡é“æ¨¡å¼"><a class="header-anchor" href="#2-Pipeline-ç®¡é“æ¨¡å¼"></a>2. Pipeline (ç®¡é“æ¨¡å¼)</h3>
<p>ç®¡é“æ¨¡å¼å°†æ•°æ®å¤„ç†åˆ†è§£ä¸ºä¸€ç³»åˆ—é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µç”±ä¸€ä¸ªæˆ–å¤šä¸ªgoroutineå¤„ç†ï¼š</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">generator</span><span class="hljs-params">(nums ...<span class="hljs-keyword">int</span>)</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;
    out := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(out)
        <span class="hljs-keyword">for</span> _, n := <span class="hljs-keyword">range</span> nums &#123;
            out &lt;- n
        &#125;
    &#125;()
    <span class="hljs-keyword">return</span> out
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">square</span><span class="hljs-params">(in &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;
    out := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(out)
        <span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> in &#123;
            out &lt;- n * n
        &#125;
    &#125;()
    <span class="hljs-keyword">return</span> out
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">filter</span><span class="hljs-params">(in &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, predicate <span class="hljs-keyword">func</span>(<span class="hljs-keyword">int</span>)</span> <span class="hljs-title">bool</span>) &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;
    out := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(out)
        <span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> in &#123;
            <span class="hljs-keyword">if</span> predicate(n) &#123;
                out &lt;- n
            &#125;
        &#125;
    &#125;()
    <span class="hljs-keyword">return</span> out
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
    <span class="hljs-comment">// æ„å»ºç®¡é“: ç”Ÿæˆæ•°å­— -&gt; å¹³æ–¹ -&gt; è¿‡æ»¤å¶æ•°</span>
    c := generator(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
    c = square(c)
    c = filter(c, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">bool</span></span> &#123;
        <span class="hljs-keyword">return</span> n%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>
    &#125;)
    
    <span class="hljs-comment">// æ¶ˆè´¹ç»“æœ</span>
    <span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> c &#123;
        fmt.Println(n) <span class="hljs-comment">// è¾“å‡º: 4, 16</span>
    &#125;
&#125;</code></pre>
<p>ç®¡é“æ¨¡å¼é€‚åˆå¤„ç†æ•°æ®æµï¼Œæ¯ä¸ªé˜¶æ®µä¸“æ³¨äºä¸€ä¸ªè½¬æ¢ï¼Œä½¿ä»£ç æ›´æ¨¡å—åŒ–ã€å¯ç»´æŠ¤ã€‚</p>
<h3 id="3-Fan-Out-Fan-In-æ‰‡å‡ºæ‰‡å…¥æ¨¡å¼"><a class="header-anchor" href="#3-Fan-Out-Fan-In-æ‰‡å‡ºæ‰‡å…¥æ¨¡å¼"></a>3. Fan-Out, Fan-In (æ‰‡å‡ºæ‰‡å…¥æ¨¡å¼)</h3>
<p>å½“æŸä¸ªé˜¶æ®µè®¡ç®—å¯†é›†æˆ–IOå¯†é›†æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªgoroutineå¹¶è¡Œå¤„ç†ï¼Œç„¶ååˆå¹¶ç»“æœï¼š</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fanOut</span><span class="hljs-params">(in &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, workers <span class="hljs-keyword">int</span>)</span> []&lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;
    channels := <span class="hljs-built_in">make</span>([]&lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, workers)
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; workers; i++ &#123;
        channels[i] = processChannel(in)
    &#125;
    <span class="hljs-keyword">return</span> channels
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fanIn</span><span class="hljs-params">(channels []&lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;
    out := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    <span class="hljs-keyword">var</span> wg sync.WaitGroup
    wg.Add(<span class="hljs-built_in">len</span>(channels))
    
    <span class="hljs-comment">// ä¸ºæ¯ä¸ªè¾“å…¥channelå¯åŠ¨ä¸€ä¸ªgoroutine</span>
    <span class="hljs-keyword">for</span> _, ch := <span class="hljs-keyword">range</span> channels &#123;
        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span> &#123;
            <span class="hljs-keyword">defer</span> wg.Done()
            <span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> c &#123;
                out &lt;- n
            &#125;
        &#125;(ch)
    &#125;
    
    <span class="hljs-comment">// æ‰€æœ‰è¾“å…¥channelå…³é—­åå…³é—­è¾“å‡ºchannel</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        wg.Wait()
        <span class="hljs-built_in">close</span>(out)
    &#125;()
    
    <span class="hljs-keyword">return</span> out
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processChannel</span><span class="hljs-params">(in &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span> &lt;-<span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;
    out := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(out)
        <span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> in &#123;
            <span class="hljs-comment">// å‡è®¾è¿™æ˜¯CPUå¯†é›†å‹æ“ä½œ</span>
            result := complexCalculation(n)
            out &lt;- result
        &#125;
    &#125;()
    <span class="hljs-keyword">return</span> out
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
    input := generator(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>)
    
    <span class="hljs-comment">// æ‰‡å‡ºåˆ°4ä¸ªworker</span>
    channels := fanOut(input, <span class="hljs-number">4</span>)
    
    <span class="hljs-comment">// æ‰‡å…¥ç»“æœ</span>
    merged := fanIn(channels)
    
    <span class="hljs-comment">// ä½¿ç”¨ç»“æœ</span>
    <span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> merged &#123;
        fmt.Println(n)
    &#125;
&#125;</code></pre>
<p>æ‰‡å‡ºæ‰‡å…¥æ¨¡å¼ç‰¹åˆ«é€‚åˆéœ€è¦å¹¶è¡Œå¤„ç†çš„åœºæ™¯ï¼Œå¦‚å¹¶è¡ŒAPIè¯·æ±‚ã€å¹¶è¡Œæ–‡ä»¶å¤„ç†ç­‰ã€‚</p>
<h3 id="4-Timeout-Pattern-è¶…æ—¶æ¨¡å¼"><a class="header-anchor" href="#4-Timeout-Pattern-è¶…æ—¶æ¨¡å¼"></a>4. Timeout Pattern (è¶…æ—¶æ¨¡å¼)</h3>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé¿å…æ— é™æœŸç­‰å¾…æ˜¯å¾ˆé‡è¦çš„ã€‚Goçš„<code>select</code>è¯­å¥ä½¿æ·»åŠ è¶…æ—¶å˜å¾—ç®€å•ï¼š</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchDataWithTimeout</span><span class="hljs-params">(url <span class="hljs-keyword">string</span>, timeout time.Duration)</span> <span class="hljs-params">([]<span class="hljs-keyword">byte</span>, error)</span></span> &#123;
    responseCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">byte</span>)
    errorCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> error)
    
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-comment">// å‘èµ·HTTPè¯·æ±‚</span>
        resp, err := http.Get(url)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
            errorCh &lt;- err
            <span class="hljs-keyword">return</span>
        &#125;
        <span class="hljs-keyword">defer</span> resp.Body.Close()
        
        <span class="hljs-comment">// è¯»å–å“åº”</span>
        data, err := io.ReadAll(resp.Body)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
            errorCh &lt;- err
            <span class="hljs-keyword">return</span>
        &#125;
        
        responseCh &lt;- data
    &#125;()
    
    <span class="hljs-comment">// ç­‰å¾…ç»“æœæˆ–è¶…æ—¶</span>
    <span class="hljs-keyword">select</span> &#123;
    <span class="hljs-keyword">case</span> data := &lt;-responseCh:
        <span class="hljs-keyword">return</span> data, <span class="hljs-literal">nil</span>
    <span class="hljs-keyword">case</span> err := &lt;-errorCh:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    <span class="hljs-keyword">case</span> &lt;-time.After(timeout):
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">&quot;request timed out after %v&quot;</span>, timeout)
    &#125;
&#125;</code></pre>
<p>è¿™ä¸ªæ¨¡å¼å¯ä»¥åº”ç”¨äºä»»ä½•å¯èƒ½è€—æ—¶çš„æ“ä½œï¼Œç¡®ä¿ä½ çš„ç¨‹åºä¸ä¼šæ— é™æœŸç­‰å¾…æŸä¸ªæ“ä½œå®Œæˆã€‚</p>
<h3 id="5-å–æ¶ˆæ¨¡å¼-Cancellation-Pattern"><a class="header-anchor" href="#5-å–æ¶ˆæ¨¡å¼-Cancellation-Pattern"></a>5. å–æ¶ˆæ¨¡å¼ (Cancellation Pattern)</h3>
<p>Goçš„<code>context</code>åŒ…æä¾›äº†å–æ¶ˆæ“ä½œçš„æ ‡å‡†æ–¹å¼ï¼š</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processWithCancellation</span><span class="hljs-params">(ctx context.Context, tasks []<span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;
    <span class="hljs-keyword">for</span> _, task := <span class="hljs-keyword">range</span> tasks &#123;
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦åº”è¯¥å–æ¶ˆ</span>
        <span class="hljs-keyword">select</span> &#123;
        <span class="hljs-keyword">case</span> &lt;-ctx.Done():
            <span class="hljs-keyword">return</span> ctx.Err()
        <span class="hljs-keyword">default</span>:
            <span class="hljs-comment">// ç»§ç»­å¤„ç†</span>
        &#125;
        
        <span class="hljs-comment">// å¤„ç†ä»»åŠ¡</span>
        err := processTask(task)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
            <span class="hljs-keyword">return</span> err
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
    <span class="hljs-comment">// åˆ›å»ºå¯å–æ¶ˆçš„context</span>
    ctx, cancel := context.WithTimeout(context.Background(), <span class="hljs-number">5</span>*time.Second)
    <span class="hljs-keyword">defer</span> cancel() <span class="hljs-comment">// ç¡®ä¿æ‰€æœ‰è·¯å¾„éƒ½è°ƒç”¨cancel</span>
    
    tasks := []<span class="hljs-keyword">string</span>&#123;<span class="hljs-string">&quot;task1&quot;</span>, <span class="hljs-string">&quot;task2&quot;</span>, <span class="hljs-string">&quot;task3&quot;</span>&#125;
    err := processWithCancellation(ctx, tasks)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
        fmt.Printf(<span class="hljs-string">&quot;å¤„ç†ä¸­æ–­: %v\n&quot;</span>, err)
    &#125;
&#125;</code></pre>
<p>å–æ¶ˆæ¨¡å¼çš„æœ€ä½³å®è·µï¼š</p>
<ul>
<li>æ€»æ˜¯ä¼ é€’contextä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</li>
<li>ä¸è¦åœ¨å‡½æ•°ä¸­å­˜å‚¨contextï¼Œè€Œæ˜¯ä¼ é€’å®ƒ</li>
<li>ä½¿ç”¨<code>defer cancel()</code>ç¡®ä¿èµ„æºé‡Šæ”¾</li>
<li>å®šæœŸæ£€æŸ¥<code>ctx.Done()</code>ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾ªç¯ä¸­</li>
</ul>
<h2 id="ğŸ”-å¹¶å‘é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ"><a class="header-anchor" href="#ğŸ”-å¹¶å‘é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ"></a>ğŸ” å¹¶å‘é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ</h2>
<p>å³ä½¿æœ‰ä¼˜é›…çš„å¹¶å‘æ¨¡å‹ï¼ŒGoç¼–ç¨‹ä¸­ä»æœ‰ä¸€äº›å¸¸è§é™·é˜±éœ€è¦é¿å…ï¼š</p>
<h3 id="1-å¹¶å‘è®¿é—®å…±äº«æ•°æ®"><a class="header-anchor" href="#1-å¹¶å‘è®¿é—®å…±äº«æ•°æ®"></a>1. å¹¶å‘è®¿é—®å…±äº«æ•°æ®</h3>
<p>æœ€å¸¸è§çš„å¹¶å‘é—®é¢˜æ˜¯å¤šä¸ªgoroutineåŒæ—¶è®¿é—®å…±äº«æ•°æ®ï¼š</p>
<pre><code class="hljs go"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹</span>
counter := <span class="hljs-number">0</span>
<span class="hljs-keyword">var</span> wg sync.WaitGroup

<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ &#123;
    wg.Add(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> wg.Done()
        counter++ <span class="hljs-comment">// ç«æ€æ¡ä»¶!</span>
    &#125;()
&#125;

wg.Wait()
fmt.Println(counter) <span class="hljs-comment">// å¯èƒ½ä¸æ˜¯1000</span></code></pre>
<p>è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨äº’æ–¥é”</strong></li>
</ol>
<pre><code class="hljs go"><span class="hljs-keyword">var</span> (
    counter <span class="hljs-keyword">int</span>
    mu      sync.Mutex
    wg      sync.WaitGroup
)

<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ &#123;
    wg.Add(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> wg.Done()
        mu.Lock()
        counter++
        mu.Unlock()
    &#125;()
&#125;

wg.Wait()
fmt.Println(counter) <span class="hljs-comment">// 1000</span></code></pre>
<ol start="2">
<li><strong>ä½¿ç”¨atomicåŒ…</strong></li>
</ol>
<pre><code class="hljs go"><span class="hljs-keyword">var</span> (
    counter <span class="hljs-keyword">int64</span>
    wg      sync.WaitGroup
)

<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ &#123;
    wg.Add(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> wg.Done()
        atomic.AddInt64(&amp;counter, <span class="hljs-number">1</span>)
    &#125;()
&#125;

wg.Wait()
fmt.Println(counter) <span class="hljs-comment">// 1000</span></code></pre>
<ol start="3">
<li><strong>ä½¿ç”¨channelé€šä¿¡</strong></li>
</ol>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
    counter := <span class="hljs-number">0</span>
    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;, <span class="hljs-number">1000</span>)
    <span class="hljs-keyword">var</span> wg sync.WaitGroup
    
    <span class="hljs-comment">// ç”Ÿäº§incrementä¿¡å·</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ &#123;
        wg.Add(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
            <span class="hljs-keyword">defer</span> wg.Done()
            ch &lt;- <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125; <span class="hljs-comment">// å‘é€ä¿¡å·</span>
        &#125;()
    &#125;
    
    <span class="hljs-comment">// å…³é—­channel(å½“æ‰€æœ‰goroutineå®Œæˆæ—¶)</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        wg.Wait()
        <span class="hljs-built_in">close</span>(ch)
    &#125;()
    
    <span class="hljs-comment">// è®¡æ•°ä¿¡å·</span>
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">range</span> ch &#123;
        counter++
    &#125;
    
    fmt.Println(counter) <span class="hljs-comment">// 1000</span>
&#125;</code></pre>
<h3 id="2-goroutineæ³„æ¼"><a class="header-anchor" href="#2-goroutineæ³„æ¼"></a>2. goroutineæ³„æ¼</h3>
<p>goroutineæ³„æ¼æ˜¯æŒ‡åˆ›å»ºçš„goroutineæ°¸è¿œä¸ä¼šé€€å‡ºï¼Œä»è€Œæ¶ˆè€—èµ„æºï¼š</p>
<pre><code class="hljs go"><span class="hljs-comment">// æœ‰æ³„æ¼é£é™©çš„ä»£ç </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">leakyFunction</span><span class="hljs-params">()</span> <span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;
    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        val := expensiveOperation()
        ch &lt;- val <span class="hljs-comment">// å¦‚æœæ²¡äººæ¥æ”¶ï¼Œå°†æ°¸è¿œé˜»å¡</span>
    &#125;()
    <span class="hljs-keyword">return</span> ch
&#125;</code></pre>
<p>é¿å…goroutineæ³„æ¼çš„æŠ€å·§ï¼š</p>
<ol>
<li><strong>æ€»æ˜¯ç¡®ä¿channelèƒ½å…³é—­</strong></li>
</ol>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">nonLeakyFunction</span><span class="hljs-params">()</span> <span class="hljs-title">chan</span> <span class="hljs-title">int</span></span> &#123;
    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// ç¼“å†²åŒºç¡®ä¿å‘é€ä¸ä¼šé˜»å¡</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        val := expensiveOperation()
        ch &lt;- val
        <span class="hljs-built_in">close</span>(ch) <span class="hljs-comment">// æ˜¾å¼å…³é—­channel</span>
    &#125;()
    <span class="hljs-keyword">return</span> ch
&#125;</code></pre>
<ol start="2">
<li><strong>ä½¿ç”¨contextè¿›è¡Œå–æ¶ˆæ§åˆ¶</strong></li>
</ol>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">withContextFunction</span><span class="hljs-params">(ctx context.Context)</span> <span class="hljs-params">(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, error)</span></span> &#123;
    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(ch)
        
        result, err := expensiveOperation()
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-comment">// å…³é—­channelå¹¶é€€å‡º</span>
        &#125;
        
        <span class="hljs-comment">// å°è¯•å‘é€æˆ–å“åº”å–æ¶ˆ</span>
        <span class="hljs-keyword">select</span> &#123;
        <span class="hljs-keyword">case</span> ch &lt;- result:
            <span class="hljs-comment">// æˆåŠŸå‘é€</span>
        <span class="hljs-keyword">case</span> &lt;-ctx.Done():
            <span class="hljs-comment">// contextå·²å–æ¶ˆ</span>
            <span class="hljs-keyword">return</span>
        &#125;
    &#125;()
    <span class="hljs-keyword">return</span> ch, <span class="hljs-literal">nil</span>
&#125;</code></pre>
<h3 id="3-æ­»é”"><a class="header-anchor" href="#3-æ­»é”"></a>3. æ­»é”</h3>
<p>æ­»é”åœ¨goroutineäº’ç›¸ç­‰å¾…æ—¶å‘ç”Ÿï¼š</p>
<pre><code class="hljs go"><span class="hljs-comment">// æ­»é”ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
    ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    ch2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        ch1 &lt;- <span class="hljs-number">42</span> <span class="hljs-comment">// é˜»å¡ç›´åˆ°æœ‰äººä»ch1æ¥æ”¶</span>
        val := &lt;-ch2 <span class="hljs-comment">// æ°¸è¿œä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ</span>
        fmt.Println(val)
    &#125;()
    
    val := &lt;-ch2 <span class="hljs-comment">// é˜»å¡ç­‰å¾…ch2ï¼Œä½†æ²¡äººä¼šå‘é€</span>
    ch1 &lt;- val   <span class="hljs-comment">// æ°¸è¿œä¸ä¼šæ‰§è¡Œ</span>
&#125;</code></pre>
<p>é¿å…æ­»é”çš„ç­–ç•¥ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨ç¼“å†²channel</strong></li>
<li><strong>æ­£ç¡®è®¾è®¡é€šä¿¡é¡ºåº</strong></li>
<li><strong>ä½¿ç”¨selectå¤„ç†å¤šä¸ªchannel</strong></li>
<li><strong>è®¾ç½®è¶…æ—¶æœºåˆ¶</strong></li>
</ol>
<pre><code class="hljs go"><span class="hljs-comment">// ä½¿ç”¨selecté¿å…æ­»é”</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
    ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    ch2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
    
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">select</span> &#123;
        <span class="hljs-keyword">case</span> ch1 &lt;- <span class="hljs-number">42</span>:
            <span class="hljs-comment">// ch1æˆåŠŸå‘é€</span>
        <span class="hljs-keyword">case</span> val := &lt;-ch2:
            <span class="hljs-comment">// ä»ch2æ¥æ”¶</span>
            fmt.Println(val)
        <span class="hljs-keyword">case</span> &lt;-time.After(time.Second):
            <span class="hljs-comment">// è¶…æ—¶ï¼Œé¿å…æ°¸ä¹…é˜»å¡</span>
            fmt.Println(<span class="hljs-string">&quot;è¶…æ—¶&quot;</span>)
            <span class="hljs-keyword">return</span>
        &#125;
    &#125;()
    
    <span class="hljs-keyword">select</span> &#123;
    <span class="hljs-keyword">case</span> val := &lt;-ch1:
        <span class="hljs-comment">// å¤„ç†ä»ch1æ¥æ”¶çš„å€¼</span>
        ch2 &lt;- val * <span class="hljs-number">2</span>
    <span class="hljs-keyword">case</span> ch2 &lt;- <span class="hljs-number">10</span>:
        <span class="hljs-comment">// å‘ch2å‘é€å€¼</span>
    <span class="hljs-keyword">case</span> &lt;-time.After(time.Second):
        <span class="hljs-comment">// è¶…æ—¶å¤„ç†</span>
        fmt.Println(<span class="hljs-string">&quot;è¶…æ—¶&quot;</span>)
    &#125;
&#125;</code></pre>
<h2 id="ğŸš€-æ€§èƒ½è°ƒä¼˜å®æˆ˜"><a class="header-anchor" href="#ğŸš€-æ€§èƒ½è°ƒä¼˜å®æˆ˜"></a>ğŸš€ æ€§èƒ½è°ƒä¼˜å®æˆ˜</h2>
<h3 id="1-æ€§èƒ½åˆ†æå·¥å…·"><a class="header-anchor" href="#1-æ€§èƒ½åˆ†æå·¥å…·"></a>1. æ€§èƒ½åˆ†æå·¥å…·</h3>
<p>Goæä¾›äº†å¼ºå¤§çš„æ€§èƒ½åˆ†æå·¥å…·ï¼š</p>
<pre><code class="hljs go"><span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;net/http&quot;</span>
    _ <span class="hljs-string">&quot;net/http/pprof&quot;</span> <span class="hljs-comment">// ä»…å¯¼å…¥ï¼Œä¸ç›´æ¥ä½¿ç”¨</span>
    <span class="hljs-string">&quot;runtime&quot;</span>
    <span class="hljs-string">&quot;runtime/pprof&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
    <span class="hljs-comment">// å¯åŠ¨pprof HTTPæœåŠ¡å™¨(åœ¨ç”Ÿäº§ç¯å¢ƒè¦å°å¿ƒä½¿ç”¨)</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        http.ListenAndServe(<span class="hljs-string">&quot;localhost:6060&quot;</span>, <span class="hljs-literal">nil</span>)
    &#125;()
    
    <span class="hljs-comment">// CPUåˆ†æ</span>
    f, _ := os.Create(<span class="hljs-string">&quot;cpu.prof&quot;</span>)
    <span class="hljs-keyword">defer</span> f.Close()
    pprof.StartCPUProfile(f)
    <span class="hljs-keyword">defer</span> pprof.StopCPUProfile()
    
    <span class="hljs-comment">// ä½ çš„ç¨‹åº...</span>
    
    <span class="hljs-comment">// å†…å­˜åˆ†æ</span>
    memoryProfile, _ := os.Create(<span class="hljs-string">&quot;memory.prof&quot;</span>)
    <span class="hljs-keyword">defer</span> memoryProfile.Close()
    runtime.GC() <span class="hljs-comment">// åœ¨åˆ†æå‰æ‰§è¡ŒGC</span>
    pprof.WriteHeapProfile(memoryProfile)
&#125;</code></pre>
<p>ä½¿ç”¨è¿™äº›æ–‡ä»¶è¿›è¡Œåˆ†æï¼š</p>
<pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹CPUçƒ­ç‚¹</span>
go tool pprof -http=:8080 cpu.prof

<span class="hljs-comment"># æŸ¥çœ‹å†…å­˜åˆ†é…çƒ­ç‚¹ </span>
go tool pprof -http=:8080 memory.prof</code></pre>
<h3 id="2-é¿å…è¿‡åº¦å¹¶å‘"><a class="header-anchor" href="#2-é¿å…è¿‡åº¦å¹¶å‘"></a>2. é¿å…è¿‡åº¦å¹¶å‘</h3>
<p>è™½ç„¶Goå¤„ç†å¹¶å‘çš„èƒ½åŠ›å¾ˆå¼ºï¼Œä½†è¿‡å¤šçš„goroutineä¹Ÿä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼š</p>
<pre><code class="hljs go"><span class="hljs-comment">// é™åˆ¶å¹¶å‘æ•°çš„å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">limitedConcurrency</span><span class="hljs-params">(tasks []Task, maxConcurrency <span class="hljs-keyword">int</span>)</span> []<span class="hljs-title">Result</span></span> &#123;
    taskCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Task, <span class="hljs-built_in">len</span>(tasks))
    resultCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> Result, <span class="hljs-built_in">len</span>(tasks))
    
    <span class="hljs-comment">// å¡«å……ä»»åŠ¡é€šé“</span>
    <span class="hljs-keyword">for</span> _, task := <span class="hljs-keyword">range</span> tasks &#123;
        taskCh &lt;- task
    &#125;
    <span class="hljs-built_in">close</span>(taskCh)
    
    <span class="hljs-comment">// é™åˆ¶workeræ•°é‡</span>
    workers := min(maxConcurrency, <span class="hljs-built_in">len</span>(tasks))
    <span class="hljs-keyword">var</span> wg sync.WaitGroup
    
    <span class="hljs-comment">// å¯åŠ¨å›ºå®šæ•°é‡çš„worker</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; workers; i++ &#123;
        wg.Add(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
            <span class="hljs-keyword">defer</span> wg.Done()
            <span class="hljs-keyword">for</span> task := <span class="hljs-keyword">range</span> taskCh &#123;
                result := processTask(task)
                resultCh &lt;- result
            &#125;
        &#125;()
    &#125;
    
    <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰workerå®Œæˆï¼Œç„¶åå…³é—­ç»“æœé€šé“</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        wg.Wait()
        <span class="hljs-built_in">close</span>(resultCh)
    &#125;()
    
    <span class="hljs-comment">// æ”¶é›†ç»“æœ</span>
    results := <span class="hljs-built_in">make</span>([]Result, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(tasks))
    <span class="hljs-keyword">for</span> result := <span class="hljs-keyword">range</span> resultCh &#123;
        results = <span class="hljs-built_in">append</span>(results, result)
    &#125;
    
    <span class="hljs-keyword">return</span> results
&#125;</code></pre>
<p>ä½•æ—¶éœ€è¦é™åˆ¶å¹¶å‘ï¼š</p>
<ul>
<li>IOå¯†é›†å‹æ“ä½œ(å¦‚ç½‘ç»œè¯·æ±‚)ï¼šé€šå¸¸å¯ä»¥æœ‰è¾ƒé«˜çš„å¹¶å‘åº¦</li>
<li>CPUå¯†é›†å‹æ“ä½œï¼šå¹¶å‘åº¦æœ€å¥½æ¥è¿‘CPUæ ¸å¿ƒæ•°</li>
<li>å­˜åœ¨å…±äº«èµ„æº(å¦‚æ•°æ®åº“è¿æ¥)ï¼šæ ¹æ®èµ„æºå®¹é‡é™åˆ¶</li>
</ul>
<h3 id="3-ä¼˜åŒ–å†…å­˜åˆ†é…"><a class="header-anchor" href="#3-ä¼˜åŒ–å†…å­˜åˆ†é…"></a>3. ä¼˜åŒ–å†…å­˜åˆ†é…</h3>
<p>å‡å°‘åƒåœ¾å›æ”¶å‹åŠ›çš„å…³é”®æ˜¯å‡å°‘å†…å­˜åˆ†é…ï¼š</p>
<pre><code class="hljs go"><span class="hljs-comment">// æœªä¼˜åŒ–ç‰ˆæœ¬</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processLargeData</span><span class="hljs-params">(data []<span class="hljs-keyword">int</span>)</span> []<span class="hljs-title">int</span></span> &#123;
    <span class="hljs-keyword">var</span> result []<span class="hljs-keyword">int</span>
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> data &#123;
        <span class="hljs-keyword">if</span> v%<span class="hljs-number">2</span> == <span class="hljs-number">0</span> &#123;
            result = <span class="hljs-built_in">append</span>(result, v)
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> result
&#125;

<span class="hljs-comment">// ä¼˜åŒ–ç‰ˆæœ¬(é¢„åˆ†é…å†…å­˜)</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processLargeDataOptimized</span><span class="hljs-params">(data []<span class="hljs-keyword">int</span>)</span> []<span class="hljs-title">int</span></span> &#123;
    <span class="hljs-comment">// é¢„ä¼°ç»“æœå¤§å°(å‡è®¾çº¦ä¸€åŠæ˜¯å¶æ•°)</span>
    result := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data)/<span class="hljs-number">2</span>)
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> data &#123;
        <span class="hljs-keyword">if</span> v%<span class="hljs-number">2</span> == <span class="hljs-number">0</span> &#123;
            result = <span class="hljs-built_in">append</span>(result, v)
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> result
&#125;</code></pre>
<p>æ›´å¤šå†…å­˜ä¼˜åŒ–æŠ€å·§ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨å¯¹è±¡æ± </strong></li>
</ol>
<pre><code class="hljs go"><span class="hljs-keyword">var</span> bufferPool = sync.Pool&#123;
    New: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">interface</span></span>&#123;&#125; &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span>(bytes.Buffer)
    &#125;,
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processRequest</span><span class="hljs-params">()</span></span> &#123;
    <span class="hljs-comment">// ä»æ± è·å–å¯¹è±¡</span>
    buf := bufferPool.Get().(*bytes.Buffer)
    buf.Reset() <span class="hljs-comment">// é‡ç½®çŠ¶æ€</span>
    
    <span class="hljs-comment">// ä½¿ç”¨ç¼“å†²åŒº</span>
    buf.WriteString(<span class="hljs-string">&quot;some data&quot;</span>)
    processBuffer(buf)
    
    <span class="hljs-comment">// å½’è¿˜å¯¹è±¡åˆ°æ± </span>
    bufferPool.Put(buf)
&#125;</code></pre>
<ol start="2">
<li><strong>é›¶æ‹·è´æŠ€æœ¯</strong></li>
</ol>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">copyData</span><span class="hljs-params">(dst, src []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-title">int</span></span> &#123;
    <span class="hljs-comment">// é¿å…ä¸å¿…è¦çš„å¤åˆ¶</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">copy</span>(dst, src)
&#125;

<span class="hljs-comment">// å­—ç¬¦ä¸²è½¬æ¢ä¸åˆ†é…æ–°å†…å­˜</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">stringToBytes</span><span class="hljs-params">(s <span class="hljs-keyword">string</span>)</span> []<span class="hljs-title">byte</span></span> &#123;
    <span class="hljs-keyword">return</span> *(*[]<span class="hljs-keyword">byte</span>)(unsafe.Pointer(
        &amp;<span class="hljs-keyword">struct</span> &#123;
            <span class="hljs-keyword">string</span>
            Cap <span class="hljs-keyword">int</span>
        &#125;&#123;s, <span class="hljs-built_in">len</span>(s)&#125;,
    ))
&#125;</code></pre>
<h3 id="4-CPUç¼“å­˜ä¼˜åŒ–"><a class="header-anchor" href="#4-CPUç¼“å­˜ä¼˜åŒ–"></a>4. CPUç¼“å­˜ä¼˜åŒ–</h3>
<p>ç†è§£CPUç¼“å­˜å¯ä»¥å¸®åŠ©ç¼–å†™æ›´é«˜æ•ˆçš„ä»£ç ï¼š</p>
<pre><code class="hljs go"><span class="hljs-comment">// ç¼“å­˜ä¸å‹å¥½(æŒ‰åˆ—è®¿é—®2Dæ•°ç»„)</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sumMatrixByColumn</span><span class="hljs-params">(matrix [][]<span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;
    sum := <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(matrix[<span class="hljs-number">0</span>]); i++ &#123;
        <span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; <span class="hljs-built_in">len</span>(matrix); j++ &#123;
            sum += matrix[j][i] <span class="hljs-comment">// è·¨è¶Šå†…å­˜ï¼Œç¼“å­˜å‘½ä¸­ç‡ä½</span>
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> sum
&#125;

<span class="hljs-comment">// ç¼“å­˜å‹å¥½(æŒ‰è¡Œè®¿é—®2Dæ•°ç»„)</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sumMatrixByRow</span><span class="hljs-params">(matrix [][]<span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;
    sum := <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(matrix); i++ &#123;
        <span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; <span class="hljs-built_in">len</span>(matrix[i]); j++ &#123;
            sum += matrix[i][j] <span class="hljs-comment">// é¡ºåºè®¿é—®å†…å­˜ï¼Œç¼“å­˜å‘½ä¸­ç‡é«˜</span>
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> sum
&#125;</code></pre>
<p>ç¼“å­˜ä¼˜åŒ–çš„å…³é”®åŸåˆ™ï¼š</p>
<ul>
<li>å°½é‡ä¿æŒæ•°æ®è®¿é—®çš„ç©ºé—´å±€éƒ¨æ€§</li>
<li>ä½¿ç”¨é€‚åˆç¼“å­˜è¡Œå¤§å°(é€šå¸¸64å­—èŠ‚)çš„æ•°æ®ç»“æ„</li>
<li>é¿å…é¢‘ç¹è·¨è¶Šå¤§å†…å­˜åŒºåŸŸ</li>
</ul>
<h3 id="5-é¿å…åå°„å’Œinterface"><a class="header-anchor" href="#5-é¿å…åå°„å’Œinterface"></a>5. é¿å…åå°„å’Œinterface{}</h3>
<p>Goçš„åå°„åŠŸèƒ½å¼ºå¤§ä½†å¼€é”€å¤§ï¼š</p>
<pre><code class="hljs go"><span class="hljs-comment">// ä½¿ç”¨åå°„(è¾ƒæ…¢)</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getField</span><span class="hljs-params">(obj <span class="hljs-keyword">interface</span>&#123;&#125;, fieldName <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">interface</span></span>&#123;&#125; &#123;
    v := reflect.ValueOf(obj)
    <span class="hljs-keyword">if</span> v.Kind() == reflect.Ptr &#123;
        v = v.Elem()
    &#125;
    <span class="hljs-keyword">return</span> v.FieldByName(fieldName).Interface()
&#125;

<span class="hljs-comment">// ä¸ä½¿ç”¨åå°„(æ›´å¿«)</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;
    Name <span class="hljs-keyword">string</span>
    Age  <span class="hljs-keyword">int</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getUserName</span><span class="hljs-params">(u User)</span> <span class="hljs-title">string</span></span> &#123;
    <span class="hljs-keyword">return</span> u.Name
&#125;</code></pre>
<p>ä½•æ—¶é¿å…ä½¿ç”¨<code>interface&#123;&#125;</code>ï¼š</p>
<ul>
<li>æ€§èƒ½å…³é”®è·¯å¾„</li>
<li>é«˜é¢‘è°ƒç”¨çš„å‡½æ•°</li>
<li>å¤„ç†å¤§é‡æ•°æ®çš„å¾ªç¯</li>
</ul>
<h3 id="6-ä½¿ç”¨åŸºå‡†æµ‹è¯•é©±åŠ¨ä¼˜åŒ–"><a class="header-anchor" href="#6-ä½¿ç”¨åŸºå‡†æµ‹è¯•é©±åŠ¨ä¼˜åŒ–"></a>6. ä½¿ç”¨åŸºå‡†æµ‹è¯•é©±åŠ¨ä¼˜åŒ–</h3>
<p>å§‹ç»ˆä½¿ç”¨åŸºå‡†æµ‹è¯•ç¡®è®¤ä¼˜åŒ–æ•ˆæœï¼š</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkProcess</span><span class="hljs-params">(b *testing.B)</span></span> &#123;
    data := generateLargeData()
    b.ResetTimer()
    
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ &#123;
        process(data)
    &#125;
&#125;</code></pre>
<p>è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼š</p>
<pre><code class="hljs bash">go <span class="hljs-built_in">test</span> -bench=. -benchmem</code></pre>
<p>åŸºå‡†æµ‹è¯•æœ€ä½³å®è·µï¼š</p>
<ul>
<li>æ¯”è¾ƒå‰åç‰ˆæœ¬ï¼Œç¡®ä¿ä¼˜åŒ–æœ‰æ•ˆ</li>
<li>å…³æ³¨å†…å­˜åˆ†é…æ¬¡æ•°å’Œæ€»é‡</li>
<li>é¿å…è¿‡æ—©ä¼˜åŒ–ï¼Œå…ˆåˆ†æåè¡ŒåŠ¨</li>
<li>ä¿æŒä»£ç å¯è¯»æ€§ï¼Œé™¤éæ€§èƒ½æå‡æ˜¾è‘—</li>
</ul>
<h2 id="ğŸ“ˆ-æ¡ˆä¾‹ç ”ç©¶ï¼šå®é™…ä¼˜åŒ–è¿‡ç¨‹"><a class="header-anchor" href="#ğŸ“ˆ-æ¡ˆä¾‹ç ”ç©¶ï¼šå®é™…ä¼˜åŒ–è¿‡ç¨‹"></a>ğŸ“ˆ æ¡ˆä¾‹ç ”ç©¶ï¼šå®é™…ä¼˜åŒ–è¿‡ç¨‹</h2>
<p>ä»¥ä¸‹æ˜¯æˆ‘åœ¨ä¸€ä¸ªçœŸå®é¡¹ç›®ä¸­ä¼˜åŒ–ä¸€ä¸ªHTTP APIæœåŠ¡çš„è¿‡ç¨‹ï¼š</p>
<h3 id="åˆå§‹ç‰ˆæœ¬"><a class="header-anchor" href="#åˆå§‹ç‰ˆæœ¬"></a>åˆå§‹ç‰ˆæœ¬</h3>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchDataHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;
    userID := r.URL.Query().Get(<span class="hljs-string">&quot;user_id&quot;</span>)
    
    <span class="hljs-comment">// è·å–ç”¨æˆ·è¯¦æƒ…</span>
    user, err := getUserDetails(userID)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, err.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
    
    <span class="hljs-comment">// è·å–ç”¨æˆ·è®¢å•</span>
    orders, err := getUserOrders(userID)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, err.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
    
    <span class="hljs-comment">// è·å–æ¨èå•†å“</span>
    recommendations, err := getRecommendations(userID)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, err.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
    
    <span class="hljs-comment">// ç»„åˆç»“æœ</span>
    result := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;
        <span class="hljs-string">&quot;user&quot;</span>: user,
        <span class="hljs-string">&quot;orders&quot;</span>: orders,
        <span class="hljs-string">&quot;recommendations&quot;</span>: recommendations,
    &#125;
    
    <span class="hljs-comment">// åºåˆ—åŒ–å¹¶è¿”å›</span>
    data, err := json.Marshal(result)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, err.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
    
    w.Header().Set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>)
    w.Write(data)
&#125;</code></pre>
<h3 id="é—®é¢˜åˆ†æ"><a class="header-anchor" href="#é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h3>
<p>ä½¿ç”¨pprofåˆ†æåå‘ç°ï¼š</p>
<ol>
<li>ä¸‰ä¸ªæ•°æ®è·å–å‡½æ•°ä¸²è¡Œæ‰§è¡Œï¼Œæ€»å“åº”æ—¶é—´æ˜¯ä¸‰è€…ä¹‹å’Œ</li>
<li>JSONåºåˆ—åŒ–å ç”¨å¤§é‡CPUæ—¶é—´</li>
<li>æ²¡æœ‰è¯·æ±‚è¶…æ—¶æ§åˆ¶</li>
</ol>
<h3 id="ä¼˜åŒ–ç‰ˆæœ¬"><a class="header-anchor" href="#ä¼˜åŒ–ç‰ˆæœ¬"></a>ä¼˜åŒ–ç‰ˆæœ¬</h3>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchDataHandlerOptimized</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;
    <span class="hljs-comment">// æ·»åŠ è¯·æ±‚çº§context</span>
    ctx, cancel := context.WithTimeout(r.Context(), <span class="hljs-number">3</span>*time.Second)
    <span class="hljs-keyword">defer</span> cancel()
    
    userID := r.URL.Query().Get(<span class="hljs-string">&quot;user_id&quot;</span>)
    
    <span class="hljs-comment">// å¹¶è¡Œè·å–æ‰€æœ‰æ•°æ®</span>
    <span class="hljs-keyword">var</span> wg sync.WaitGroup
    <span class="hljs-keyword">var</span> userMu, ordersMu, recomMu sync.Mutex
    <span class="hljs-keyword">var</span> user User
    <span class="hljs-keyword">var</span> orders []Order
    <span class="hljs-keyword">var</span> recommendations []Product
    <span class="hljs-keyword">var</span> userErr, ordersErr, recomErr error
    
    wg.Add(<span class="hljs-number">3</span>)
    
    <span class="hljs-comment">// è·å–ç”¨æˆ·è¯¦æƒ…</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> wg.Done()
        u, err := getUserDetails(ctx, userID)
        userMu.Lock()
        user, userErr = u, err
        userMu.Unlock()
    &#125;()
    
    <span class="hljs-comment">// è·å–ç”¨æˆ·è®¢å•</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> wg.Done()
        o, err := getUserOrders(ctx, userID)
        ordersMu.Lock()
        orders, ordersErr = o, err
        ordersMu.Unlock()
    &#125;()
    
    <span class="hljs-comment">// è·å–æ¨èå•†å“</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
        <span class="hljs-keyword">defer</span> wg.Done()
        r, err := getRecommendations(ctx, userID)
        recomMu.Lock()
        recommendations, recomErr = r, err
        recomMu.Unlock()
    &#125;()
    
    <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ</span>
    wg.Wait()
    
    <span class="hljs-comment">// æ£€æŸ¥é”™è¯¯</span>
    <span class="hljs-keyword">if</span> userErr != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, userErr.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
    <span class="hljs-keyword">if</span> ordersErr != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, ordersErr.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
    <span class="hljs-keyword">if</span> recomErr != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, recomErr.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
    
    <span class="hljs-comment">// ä½¿ç”¨é¢„å®šä¹‰ç»“æ„ä½“è€Œémap</span>
    result := ResponseData&#123;
        User:            user,
        Orders:          orders,
        Recommendations: recommendations,
    &#125;
    
    <span class="hljs-comment">// ä½¿ç”¨æ›´é«˜æ•ˆçš„JSONç¼–ç </span>
    w.Header().Set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>)
    
    <span class="hljs-comment">// ç›´æ¥å†™å…¥å“åº”ï¼Œé¿å…ä¸­é—´ç¼“å†²</span>
    encoder := json.NewEncoder(w)
    <span class="hljs-keyword">if</span> err := encoder.Encode(result); err != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, err.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
&#125;</code></pre>
<h3 id="è¿›ä¸€æ­¥ä¼˜åŒ–"><a class="header-anchor" href="#è¿›ä¸€æ­¥ä¼˜åŒ–"></a>è¿›ä¸€æ­¥ä¼˜åŒ–</h3>
<p>è€ƒè™‘æ›´å¤šçš„ç°å®æƒ…å†µï¼š</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchDataHandlerFinal</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;
    <span class="hljs-comment">// æ·»åŠ è¯·æ±‚çº§contextå’Œè¶…æ—¶</span>
    ctx, cancel := context.WithTimeout(r.Context(), <span class="hljs-number">3</span>*time.Second)
    <span class="hljs-keyword">defer</span> cancel()
    
    userID := r.URL.Query().Get(<span class="hljs-string">&quot;user_id&quot;</span>)
    
    <span class="hljs-comment">// ä½¿ç”¨errgroupæ›´ä¼˜é›…åœ°å¤„ç†å¹¶å‘å’Œé”™è¯¯</span>
    group, ctx := errgroup.WithContext(ctx)
    
    <span class="hljs-keyword">var</span> user User
    group.Go(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
        <span class="hljs-keyword">var</span> err error
        user, err = getUserDetails(ctx, userID)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
            <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥: %w&quot;</span>, err)
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    &#125;)
    
    <span class="hljs-keyword">var</span> orders []Order
    group.Go(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
        <span class="hljs-keyword">var</span> err error
        orders, err = getUserOrders(ctx, userID)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
            <span class="hljs-comment">// è®¢å•è·å–å¤±è´¥ä¸é˜»æ­¢æ•´ä½“å“åº”ï¼Œåªè®°å½•é”™è¯¯</span>
            log.Printf(<span class="hljs-string">&quot;è·å–ç”¨æˆ·è®¢å•å¤±è´¥: %v&quot;</span>, err)
            orders = []Order&#123;&#125; <span class="hljs-comment">// è¿”å›ç©ºè®¢å•è€Œéé”™è¯¯</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    &#125;)
    
    <span class="hljs-keyword">var</span> recommendations []Product
    group.Go(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> &#123;
        <span class="hljs-keyword">var</span> err error
        recommendations, err = getRecommendations(ctx, userID)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
            <span class="hljs-comment">// æ¨èè·å–å¤±è´¥ä¸é˜»æ­¢æ•´ä½“å“åº”</span>
            log.Printf(<span class="hljs-string">&quot;è·å–æ¨èå•†å“å¤±è´¥: %v&quot;</span>, err)
            recommendations = []Product&#123;&#125; <span class="hljs-comment">// è¿”å›ç©ºæ¨è</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    &#125;)
    
    <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ</span>
    <span class="hljs-keyword">if</span> err := group.Wait(); err != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, err.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
    
    <span class="hljs-comment">// é¢„å…ˆå®šä¹‰ç»“æ„ä½“ç±»å‹å¹¶å¤ç”¨</span>
    result := responsePool.Get().(*ResponseData)
    <span class="hljs-keyword">defer</span> responsePool.Put(result)
    
    result.User = user
    result.Orders = orders
    result.Recommendations = recommendations
    
    <span class="hljs-comment">// ä½¿ç”¨æ›´é«˜æ•ˆçš„JSONç¼–ç </span>
    w.Header().Set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>)
    w.Header().Set(<span class="hljs-string">&quot;Cache-Control&quot;</span>, <span class="hljs-string">&quot;max-age=10&quot;</span>) <span class="hljs-comment">// æ·»åŠ åˆé€‚çš„ç¼“å­˜å¤´</span>
    
    <span class="hljs-keyword">if</span> err := json.NewEncoder(w).Encode(result); err != <span class="hljs-literal">nil</span> &#123;
        http.Error(w, err.Error(), http.StatusInternalServerError)
        <span class="hljs-keyword">return</span>
    &#125;
&#125;

<span class="hljs-comment">// å¯¹è±¡æ± </span>
<span class="hljs-keyword">var</span> responsePool = sync.Pool&#123;
    New: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span> <span class="hljs-title">interface</span></span>&#123;&#125; &#123;
        <span class="hljs-keyword">return</span> &amp;ResponseData&#123;&#125;
    &#125;,
&#125;

<span class="hljs-keyword">type</span> ResponseData <span class="hljs-keyword">struct</span> &#123;
    User            User      <span class="hljs-string">`json:&quot;user&quot;`</span>
    Orders          []Order   <span class="hljs-string">`json:&quot;orders&quot;`</span>
    Recommendations []Product <span class="hljs-string">`json:&quot;recommendations&quot;`</span>
&#125;</code></pre>
<p>è¿™ä¸ªæœ€ç»ˆä¼˜åŒ–ç‰ˆæœ¬å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li>ä½¿ç”¨<code>errgroup</code>æ›´ä¼˜é›…åœ°å¤„ç†å¹¶å‘å’Œé”™è¯¯</li>
<li>å®ç°ä¼˜é›…é™çº§(éƒ¨åˆ†æ•°æ®è·å–å¤±è´¥ä¸å½±å“æ•´ä½“å“åº”)</li>
<li>ä½¿ç”¨å¯¹è±¡æ± å‡å°‘å†…å­˜åˆ†é…</li>
<li>æ·»åŠ é€‚å½“çš„HTTPå¤´(å¦‚ç¼“å­˜æ§åˆ¶)</li>
</ol>
<h3 id="ä¼˜åŒ–æ•ˆæœ"><a class="header-anchor" href="#ä¼˜åŒ–æ•ˆæœ"></a>ä¼˜åŒ–æ•ˆæœ</h3>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>åˆå§‹ç‰ˆæœ¬</th>
<th>æœ€ç»ˆä¼˜åŒ–ç‰ˆ</th>
<th>æ”¹è¿›</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¹³å‡å“åº”æ—¶é—´</td>
<td>350ms</td>
<td>120ms</td>
<td>65%â†“</td>
</tr>
<tr>
<td>æ¯ç§’è¯·æ±‚æ•°(RPS)</td>
<td>285</td>
<td>850</td>
<td>198%â†‘</td>
</tr>
<tr>
<td>å†…å­˜åˆ†é…</td>
<td>32KB/è¯·æ±‚</td>
<td>8KB/è¯·æ±‚</td>
<td>75%â†“</td>
</tr>
<tr>
<td>P99å»¶è¿Ÿ</td>
<td>750ms</td>
<td>180ms</td>
<td>76%â†“</td>
</tr>
</tbody>
</table>
<h2 id="ğŸ¯-æ€»ç»“"><a class="header-anchor" href="#ğŸ¯-æ€»ç»“"></a>ğŸ¯ æ€»ç»“</h2>
<p>Goè¯­è¨€çš„å¹¶å‘æ¨¡å‹ç®€æ´è€Œå¼ºå¤§ï¼ŒæŒæ¡å¸¸ç”¨çš„å¹¶å‘æ¨¡å¼å’Œæ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œå¯ä»¥å¸®åŠ©ä½ æ„å»ºçœŸæ­£é«˜æ•ˆçš„Goåº”ç”¨ã€‚</p>
<h3 id="å…³é”®è¦ç‚¹å›é¡¾"><a class="header-anchor" href="#å…³é”®è¦ç‚¹å›é¡¾"></a>å…³é”®è¦ç‚¹å›é¡¾</h3>
<ol>
<li>
<p><strong>å¹¶å‘æ¨¡å¼</strong>ï¼š</p>
<ul>
<li>Worker Poolé€‚åˆå¤„ç†ç‹¬ç«‹ä»»åŠ¡</li>
<li>Pipelineé€‚åˆæ•°æ®æµå¤„ç†</li>
<li>Fan-Out/Fan-Iné€‚åˆå¹¶è¡Œå¤„ç†ç“¶é¢ˆé˜¶æ®µ</li>
<li>è¶…æ—¶å’Œå–æ¶ˆæ¨¡å¼ç¡®ä¿ç¨‹åºè¡Œä¸ºå¯æ§</li>
</ul>
</li>
<li>
<p><strong>é¿å…å¹¶å‘é™·é˜±</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨é€‚å½“åŒæ­¥æœºåˆ¶ä¿æŠ¤å…±äº«æ•°æ®</li>
<li>é˜²æ­¢goroutineæ³„æ¼</li>
<li>é¿å…æ­»é”å’Œç«æ€æ¡ä»¶</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨pprofè¯†åˆ«ç“¶é¢ˆ</li>
<li>ä¼˜åŒ–å†…å­˜åˆ†é…å’Œå‡å°‘GCå‹åŠ›</li>
<li>è€ƒè™‘CPUç¼“å­˜å‹å¥½æ€§</li>
<li>é¿å…è¿‡åº¦ä½¿ç”¨åå°„å’Œinterface{}</li>
<li>å§‹ç»ˆé€šè¿‡åŸºå‡†æµ‹è¯•éªŒè¯ä¼˜åŒ–</li>
</ul>
</li>
</ol>
<p>æˆ‘è®¤ä¸ºï¼ŒGoè¯­è¨€çš„å¹¶å‘ç¼–ç¨‹å“²å­¦å¯ä»¥æ€»ç»“ä¸ºï¼šâ€œé€šè¿‡é€šä¿¡å…±äº«å†…å­˜ï¼Œè€Œä¸æ˜¯é€šè¿‡å…±äº«å†…å­˜é€šä¿¡â€ã€‚éµå¾ªè¿™ä¸€åŸåˆ™ï¼Œä½ çš„å¹¶å‘ä»£ç å°†æ›´ç®€æ´ã€æ›´å¥å£®ã€æ›´é«˜æ•ˆã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–ç»éªŒåˆ†äº«ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºï¼</p>
<hr>
<p><strong>å‚è€ƒèµ„æ–™</strong>ï¼š</p>
<ol>
<li>ã€ŠConcurrency in Goã€‹by Katherine Cox-Buday</li>
<li>Goå®˜æ–¹åšå®¢: <a target="_blank" rel="noopener" href="https://blog.golang.org/">https://blog.golang.org/</a></li>
<li>Effective Go: <a target="_blank" rel="noopener" href="https://golang.org/doc/effective_go.html">https://golang.org/doc/effective_go.html</a></li>
<li>Uber Go Style Guide: <a target="_blank" rel="noopener" href="https://github.com/uber-go/guide">https://github.com/uber-go/guide</a><br>
&lt;/rewritten_file&gt;</li>
</ol>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Golang/">Golang</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Go/">Go</a>
                    
                      <a class="hover-with-bg" href="/tags/%E5%B9%B6%E5%8F%91/">å¹¶å‘</a>
                    
                      <a class="hover-with-bg" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">æ€§èƒ½ä¼˜åŒ–</a>
                    
                      <a class="hover-with-bg" href="/tags/goroutine/">goroutine</a>
                    
                  </div>
                
              </div>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2025/04/15/%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BD%E7%89%A9%E8%81%94%E7%BD%91%E6%A1%86%E6%9E%B6-%E4%BB%8E%E6%9E%B6%E6%9E%84%E5%88%B0%E5%AE%9E%E8%B7%B5/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">æ„å»ºé«˜æ€§èƒ½ç‰©è”ç½‘æ¡†æ¶-ä»æ¶æ„åˆ°å®è·µ</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2025/02/16/AI%20Agent%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%90%86%E5%88%B0%E5%BA%94%E7%94%A8/">
                        <span class="hidden-mobile">ğŸ¤– AI Agentå¼€å‘å®æˆ˜ï¼šä»åŸç†åˆ°åº”ç”¨</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
              <!-- Comments -->
              <div class="comments" id="comments">
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      function loadDisqus() {
        var disqus_config = function () {
          this.page.url = 'https://blog.bopop.sbs/2025/03/24/Goè¯­è¨€å¹¶å‘ç¼–ç¨‹æ¨¡å¼ä¸æ€§èƒ½è°ƒä¼˜/';
          this.page.identifier = '/2025/03/24/Goè¯­è¨€å¹¶å‘ç¼–ç¨‹æ¨¡å¼ä¸æ€§èƒ½è°ƒä¼˜/';
        };
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = '//' + '' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        })();
      }
      createObserver(loadDisqus, 'disqus_thread');
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener noopener">comments powered by Disqus.</a>
    </noscript>
  </div>


              </div>
            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  
    <div class="col-lg-7 mx-auto nopadding-md">
      <div class="container custom mx-auto">
        <img src="/img/Bopop-logo.png" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:220px; height:150px;">
      </div>
    </div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <!-- <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a> -->
        <span>Â© Bopop</span>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>





  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>




















</body>
</html>
